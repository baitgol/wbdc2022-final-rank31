******************初赛5折*********************
distrill=False  线下0.6700
distrill=True   线下0.6752
*************20220706*************
# 时间记录
# finetune  训练100step 100s
 max_frames = 8
 bert_seq_length = 32
 train_batch_size = 32

# 1、数据量20000，推理时间251s, batch_size=128,314s
## config配置建议
prefetch = 4
num_workers= 2
val_batch_size = 256

# 2、数据量20000，推理时间190s, 3轮迭代中OOM
prefetch = 8
num_workers= 4
val_batch_size = 256

# 3、数据量20000，内存OOM
prefetch = 16
num_workers= 8
val_batch_size = 256

# 4、 测试 inference, 2轮迭代的，线下6741
## 1. 数据量: 25000
    batch_size 1024
    prefetch = 16
    num_workers= 8
    OOM
## 2、 batch_size 1024/ 512
    prefetch = 16
    num_workers= 8
    显存不够

## 3、 不算加载模型写文件 238s, 总计248s
    batch_size 256
    prefetch = 16
    num_workers= 4
## 4.不算加载模型写文件 238s, 总计254s
    batch_size 256
    prefetch = 8
    num_workers= 4

### 5. version=2.0线上测试通过, 总计296s, 日志打印是显示241,255， 线上0.6746，线下+EMA的4轮/10轮0.6793, loss=1.336
    batch_size 256
    prefetch = 8
    num_workers= 4
*************20220707*************
## version=3.0 distrill=False  线下0.6803， 不能取过拟合的，效果线上只有0.668925
## version=4.0 distrill=True   线下--效果差不多，最后崩了

# 加层, video_encoder 后接 bi-gru
## version=5.0  效果一般,

*************20220708*************
## version = 3.0 baseline 线下6805，线上0.67073
## version=8.0  均匀取桢
 # 线下6805， 线上只有0.669545

## version=7.0  均匀取桢 +bigru + Add&norm
 效果不行
## version=9.0 多预测输出，求loss，差

*************20220711*************
 ## version=10.0  随即增强，效果不行
 ## version=11.0  num_cross_layer=6, 开始loss低，迭代后效果不行
 ## version=11.0  albef 线下6679 4/10轮
*************20220712*************
 ## version=12.0  apex+ap16 3/10轮， 线下6744, 训练速度100s->72s， 推理速度242s->129s, gpu内存降低20%不到
  提交一把, 线上0.668968
  # 重新跑 GPU22358MiB
  # docker安装apex

  # DP DDP fp16+DDP速度 ， 8桢+bs256， 100steps.两卡DDP提速一般
  # DP = 101s， DDP=97s， fp16+DDP=69s

 # 测试推理速度
  DP8桢+bs256, 推理速度 242s
  apex+ap16, 8桢+bs256, 推理速度 129s， gpu 82%
  apex+ap16, 16桢+bs128, 推理速度 227s， gpu 82%
  apex+ap16, 32桢+bs64, 推理速度 415s， gpu 82%
  apex+ap16, 32桢+bs72, 推理速度 417s， gpu 90+
  apex+ap16, 32桢+bs80, 推理速度 415s， gpu 82%
*************20220713*************
 ## version=13.0  apex+ap16 4/10轮，676，loss极大，线上0.665863,  bs 变小，lr未调小

 ## version=14.0  apex+ap16, 8桢+bs256, 继续调试 3/10轮,线下0.676 loss=1.277，线上0.6715
 ## v14基准,调试 version=15.0 warm_ratio = 0.05, lr调小 效果一样
 ## vesion=16.0 数据 无效果
 ## vesion=17.0  16+16, lr调小 3轮/10 6776 loss=1.294
 *************20220714*************
  ## vesion=1.0 8+32 no ema, DDP+DP
  # version=18.0 16+16, ema, ddpfp16, accumulate_step=2, lr不变， 3/10轮,线下0.6791 loss=1.271，线上0.672584
  # version=19.0 8+32,

# todo 推理时,去掉 log_softmax操作
# todo
# todo 视频+ocr(B*N形式)交互=>视频表示（Bs,768)  再与title,asr交互(BS,768), 在视频表示与文本表示交互, 改动较大